name: OpenShift Preflight

on:
  push:
  workflow_dispatch:
    inputs:
      IMAGE:
        description: "Preflight check container image (e.g. docker.io/apecloud/kubeblocks:1.0.1-certified)"
        required: false
        default: ''
      SUBMIT:
        description: "Submit check container results to Red Hat (default: false)"
        type: boolean
        required: false
        default: false


run-name: upload ${{ inputs.CHART_PACKAGE_NAME }} ${{ inputs.CHART_PACKAGE_URL }}

env:
  PFLT_PYXIS_API_TOKEN: ${{ secrets.REDHAT_API_KEY }}
  PFLT_CERTIFICATION_COMPONENT_ID: ${{ secrets.REDHAT_COMPONENT_PID }}
  PFLT_VERSION: "1.14.1"

jobs:
  preflight:
    runs-on: ubuntu-latest
    steps:
      - name: install preflight
        run: |
          PFLT_VERSION=${{ env.PFLT_VERSION }}
          wget https://github.com/redhat-openshift-ecosystem/openshift-preflight/releases/download/${PFLT_VERSION}/preflight-linux-amd64
          chmod +x preflight-linux-amd64
          mv preflight-linux-amd64 /usr/local/bin/preflight
          preflight version
