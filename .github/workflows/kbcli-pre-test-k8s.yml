name: Kbcli Pre Test on K8S

on:
  workflow_call:
    inputs:
      cloud-provider:
        description: 'cloud k8s cluster provider (e.g. vke/eks/gke/aks)'
        type: string
        required: false
        default: 'eks'
      release-version:
        description: 'kubeblocks release version'
        type: string
        required: false
        default: 'latest'
      previous-version:
        description: 'kubeblocks previous version of upgrade'
        type: string
        required: false
        default: ''
      branch-name:
        description: 'testinfra branch name'
        type: string
        required: false
        default: 'main'
      test-type:
        description: 'test type (apecloud-mysql)'
        type: string
        required: false
        default: '0'
      test-args:
        description: 'test args'
        type: string
        required: false
        default: ''
      region:
        description: 'k8s region name'
        type: string
        required: false
        default: ''
      k8s-cluster-name:
        description: 'k8s cluster name'
        type: string
        required: false
        default: ''
      artifact-name:
        description: 'terraform artifact name'
        type: string
        required: false
        default: ''
    outputs:
      test-result:
        description: "test result"
        value: ${{ jobs.install-kubeblocks.outputs.test-result }}
      random-suffix:
        description: "random suffix"
        value: ${{ jobs.install-kubeblocks.outputs.random-suffix }}


env:
  GITHUB_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

permissions:
  id-token: write
  contents: read

jobs:
  install-kubeblocks-pre:
    if: ${{ inputs.previous-version }}
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "0"
      test-type-name: "install-kubeblocks-pre"
      test-args: "--enable-addon kubebench ${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
    secrets: inherit

  apecloud-mysql-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'apecloud-mysql')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "1"
      test-type-name: "apecloud-mysql-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  postgresql-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'postgresql|') || endsWith(inputs.TEST_TYPE, 'postgresql')) && ! contains(inputs.TEST_TYPE, '-postgresql') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "2"
      test-type-name: "postgresql-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  postgresql-etcd-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'postgresql-etcd|') || endsWith(inputs.TEST_TYPE, 'postgresql-etcd')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') && ! contains(inputs.release-version, 'v0.9.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "2"
      test-type-name: "postgresql-etcd-pre"
      test-args: "--external-etcd true ${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  redis-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'redis|') || endsWith(inputs.TEST_TYPE, 'redis')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "5"
      test-type-name: "redis-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  mongodb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'mongodb|') || endsWith(inputs.TEST_TYPE, 'mongodb')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "6"
      test-type-name: "mongodb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  mongodb-shard-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'mongodb-shard|') || endsWith(inputs.TEST_TYPE, 'mongodb-shard')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "67"
      test-type-name: "mongodb-shard-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  kafka-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'kafka')) && ! contains(inputs.release-version, 'v0.5.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "7"
      test-type-name: "kafka-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  pulsar-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'pulsar|') || endsWith(inputs.TEST_TYPE, 'pulsar')) && ! contains(inputs.release-version, 'v0.5.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "8"
      test-type-name: "pulsar-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  weaviate-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'weaviate')) && ! contains(inputs.release-version, 'v0.5.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "9"
      test-type-name: "weaviate-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  qdrant-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'qdrant')) && ! contains(inputs.release-version, 'v0.5.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "10"
      test-type-name: "qdrant-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  greptimedb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'greptimedb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "11"
      test-type-name: "greptimedb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  nebula-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'nebula')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "12"
      test-type-name: "nebula-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  risingwave-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'risingwave')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "13"
      test-type-name: "risingwave-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  starrocks-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'starrocks|') || endsWith(inputs.TEST_TYPE, 'starrocks')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "14"
      test-type-name: "starrocks-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  etcd-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.TEST_TYPE, 'etcd|') || endsWith(inputs.TEST_TYPE, 'etcd')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "15"
      test-type-name: "etcd-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  oceanbase-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'oceanbase|') || endsWith(inputs.TEST_TYPE, 'oceanbase')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "16"
      test-type-name: "oceanbase-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  orioledb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'orioledb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "18"
      test-type-name: "orioledb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  vanilla-pg-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'vanilla-pg')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "20"
      test-type-name: "vanilla-pg-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  asmysql-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'asmysql|') || endsWith(inputs.TEST_TYPE, 'asmysql')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "21"
      test-type-name: "asmysql-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  asmysql-proxy-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'asmysql-proxy|') || endsWith(inputs.TEST_TYPE, 'asmysql-proxy')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') && ! contains(inputs.release-version, 'v0.9.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "21"
      test-type-name: "asmysql-proxy-pre"
      test-args: "--enable-proxy true ${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  asmysql-orc-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'asmysql-orc|') || endsWith(inputs.TEST_TYPE, 'asmysql-orc')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') && ! contains(inputs.release-version, 'v0.9.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "21"
      test-type-name: "asmysql-orc-pre"
      test-args: "--enable-orchestrator true ${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  asmysql-orc-proxy-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'asmysql-orc-proxy|') || endsWith(inputs.TEST_TYPE, 'asmysql-orc-proxy')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') && ! contains(inputs.release-version, 'v0.9.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "21"
      test-type-name: "asmysql-orc-proxy-pre"
      test-args: "--enable-proxy true --enable-orchestrator true ${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  openldap-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'openldap')) && (contains(inputs.release-version, 'v0.7.') || contains(inputs.release-version, 'v0.8.') || contains(inputs.release-version, 'v0.9.')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "22"
      test-type-name: "openldap-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  polardbx-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'polardbx')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "23"
      test-type-name: "polardbx-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  opensearch-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'opensearch')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "24"
      test-type-name: "opensearch-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  elasticsearch-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'elasticsearch')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "25"
      test-type-name: "elasticsearch-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  vllm-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'vllm')) && (contains(inputs.release-version, 'v0.7.') || contains(inputs.release-version, 'v0.8.') || contains(inputs.release-version, 'v0.9.')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "26"
      test-type-name: "vllm-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  tdengine-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'tdengine')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "27"
      test-type-name: "tdengine-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  milvus-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'milvus')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "28"
      test-type-name: "milvus-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  clickhouse-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'clickhouse')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "29"
      test-type-name: "clickhouse-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  pika-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'pika')) && (contains(inputs.KB_VERSION, 'v0.7.') || contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "30"
      test-type-name: "pika-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  ggml-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'ggml')) && (contains(inputs.release-version, 'v0.7.') || contains(inputs.release-version, 'v0.8.') || contains(inputs.release-version, 'v0.9.')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "31"
      test-type-name: "ggml-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  zookeeper-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'zookeeper')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "32"
      test-type-name: "zookeeper-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  mariadb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'mariadb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "33"
      test-type-name: "mariadb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  tidb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'tidb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "34"
      test-type-name: "tidb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  xinference-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'xinference')) && (contains(inputs.release-version, 'v0.8.') || contains(inputs.release-version, 'v0.9.')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "35"
      test-type-name: "xinference-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  oracle-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'oracle|') || endsWith(inputs.TEST_TYPE, 'oracle')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "36"
      test-type-name: "oracle"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  opengauss-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'opengauss')) && (contains(inputs.release-version, 'v0.8.') || contains(inputs.release-version, 'v0.9.')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "37"
      test-type-name: "opengauss-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  influxdb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'influxdb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "38"
      test-type-name: "influxdb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  flink-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'flink')) && (contains(inputs.release-version, 'v0.8.') || contains(inputs.release-version, 'v0.9.')) }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "39"
      test-type-name: "flink-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  solr-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'solr')) && contains(inputs.release-version, 'v0.9.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "40"
      test-type-name: "solr-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  mogdb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'mogdb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "43"
      test-type-name: "mogdb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  oceanbase-ent-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'oceanbase-ent')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "44"
      test-type-name: "oceanbase-ent-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  starrocks-ent-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'starrocks-ent')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "45"
      test-type-name: "starrocks-ent-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  yashandb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'yashandb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "47"
      test-type-name: "yashandb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  redis-cluster-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'redis-cluster')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "48"
      test-type-name: "redis-cluster-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  dmdb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'dmdb')) && contains(inputs.release-version, 'v0.9.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "50"
      test-type-name: "dmdb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  minio-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'minio')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "51"
      test-type-name: "minio-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit
  
  orchestrator-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'orchestrator')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "52"
      test-type-name: "orchestrator-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  rabbitmq-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'rabbitmq')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "53"
      test-type-name: "rabbitmq-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  loki-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'loki')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "54"
      test-type-name: "loki-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  victoria-metrics-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'victoria-metrics')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "55"
      test-type-name: "victoria-metrics-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  gaussdb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'gaussdb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "56"
      test-type-name: "gaussdb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  damengdb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'damengdb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "57"
      test-type-name: "damengdb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  kingbase-pre:
    if: ${{ inputs.CLOUD_PROVIDER != 'aks' && inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'kingbase')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "58"
      test-type-name: "kingbase-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  vastbase-pre:
    if: ${{ inputs.CLOUD_PROVIDER != 'eks' && inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'vastbase')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "59"
      test-type-name: "vastbase-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  mssql-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'mssql')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "60"
      test-type-name: "mssql-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  rocketmq-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'rocketmq')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "61"
      test-type-name: "rocketmq-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  goldendb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'goldendb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "63"
      test-type-name: "goldendb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  tdsql-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'tdsql')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "64"
      test-type-name: "tdsql-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  greatsql-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'greatsql')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "65"
      test-type-name: "greatsql-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  greatdb-pre:
    if: ${{ inputs.previous-version && (inputs.test-type == '' || contains(inputs.test-type, 'greatdb')) && ! contains(inputs.release-version, 'v0.5.') && ! contains(inputs.release-version, 'v0.6.') && ! contains(inputs.release-version, 'v0.7.') && ! contains(inputs.release-version, 'v0.8.') }}
    needs: [ install-kubeblocks-pre ]
    uses: ./.github/workflows/test-kbcli-pre.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.previous-version }}"
      test-type: "66"
      test-type-name: "greatdb-pre"
      test-args: "${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

  send-message:
    if: ${{ inputs.previous-version && always() }}
    runs-on: ubuntu-latest
    needs: [ install-kubeblocks-pre, apecloud-mysql-pre, postgresql-pre, postgresql-etcd-pre,
             redis-pre, mongodb-pre, mongodb-shard-pre, kafka-pre, pulsar-pre,
             weaviate-pre, qdrant-pre, greptimedb-pre,
             nebula-pre, risingwave-pre, starrocks-pre, etcd-pre, oceanbase-pre,
             asmysql-pre, openldap-pre, polardbx-pre,
             tdengine-pre, milvus-pre, clickhouse-pre, pika-pre, opensearch-pre,
             elasticsearch-pre, vllm-pre, orioledb-pre, vanilla-pg-pre, ggml-pre,
             zookeeper-pre, mariadb-pre , tidb-pre, xinference-pre, oracle-pre, 
             opengauss-pre, influxdb-pre, flink-pre, solr-pre,
             mogdb-pre, oceanbase-ent-pre, starrocks-ent-pre,
             yashandb-pre, redis-cluster-pre, dmdb-pre, minio-pre,
             orchestrator-pre, rabbitmq-pre, loki-pre, victoria-metrics-pre, gaussdb-pre,
             damengdb-pre, kingbase-pre, vastbase-pre, mssql-pre, rocketmq-pre,
             goldendb-pre, tdsql-pre, greatsql-pre, greatdb-pre,
             asmysql-proxy-pre, asmysql-orc-pre, asmysql-orc-proxy-pre]
    steps:
      - uses: actions/checkout@v4
        with:
          repository: apecloud/apecloud-cd
          path: ./
          ref: ${{ inputs.APECD_REF }}

      - name: send message
        run: |
          TEST_TYPE="${{ inputs.test-type }}"
          TEST_RESULT="install-kubeblocks-pre|${{ needs.install-kubeblocks-pre.outputs.test-result }}"
          if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"apecloud-mysql"* ]]; then
              TEST_RESULT="${TEST_RESULT}##apecloud-mysql-pre|${{ needs.apecloud-mysql-pre.outputs.test-result }}"
          fi
          
          if [[ "$TEST_TYPE" == '' || (("$TEST_TYPE" == *"postgresql|"* || "$TEST_TYPE" == *"postgresql") && "$TEST_TYPE" != *"-postgresql"*) ]]; then
              TEST_RESULT="${TEST_RESULT}##postgresql-pre|${{ needs.postgresql-pre.outputs.test-result }}"
          fi
          
          if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"redis|"* || "$TEST_TYPE" == *"redis" ]]; then
              TEST_RESULT="${TEST_RESULT}##redis-pre|${{ needs.redis-pre.outputs.test-result }}"
          fi
          
          if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mongodb"* ]]; then
              TEST_RESULT="${TEST_RESULT}##mongodb-pre|${{ needs.mongodb-pre.outputs.test-result }}"
          fi
          
          if [[ "${{ inputs.release-version }}" != "v0.5."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"kafka"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##kafka-pre|${{ needs.kafka-pre.outputs.test-result }}"
              fi
              
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"pulsar|"* || "$TEST_TYPE" == *"pulsar" ]]; then
                  TEST_RESULT="${TEST_RESULT}##pulsar-pre|${{ needs.pulsar-pre.outputs.test-result }}"
              fi
              
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"weaviate"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##weaviate-pre|${{ needs.weaviate-pre.outputs.test-result }}"
              fi
              
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"qdrant"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##qdrant-pre|${{ needs.qdrant-pre.outputs.test-result }}"
              fi
          fi
          
          if [[ "${{ inputs.release-version }}" != "v0.5."* && "${{ inputs.release-version }}" != "v0.6."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"greptimedb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##greptimedb-pre|${{ needs.greptimedb-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"nebula"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##nebula-pre|${{ needs.nebula-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"risingwave"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##risingwave-pre|${{ needs.risingwave-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"starrocks|"* || "$TEST_TYPE" == *"starrocks" ]]; then
                  TEST_RESULT="${TEST_RESULT}##starrocks-pre|${{ needs.starrocks-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"etcd"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##etcd-pre|${{ needs.etcd-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"oceanbase|"* || "$TEST_TYPE" == *"oceanbase" ]]; then
                  TEST_RESULT="${TEST_RESULT}##oceanbase-pre|${{ needs.oceanbase-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"asmysql|"* || "$TEST_TYPE" == *"asmysql" ]]; then
                  TEST_RESULT="${TEST_RESULT}##asmysql-pre|${{ needs.asmysql-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"openldap"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##openldap-pre|${{ needs.openldap-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"polardbx"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##polardbx-pre|${{ needs.polardbx-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"milvus"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##milvus-pre|${{ needs.milvus-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"clickhouse"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##clickhouse-pre|${{ needs.clickhouse-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"pika"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##pika-pre|${{ needs.pika-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"opensearch"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##opensearch-pre|${{ needs.opensearch-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"elasticsearch"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##elasticsearch-pre|${{ needs.elasticsearch-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"tdengine"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##tdengine-pre|${{ needs.tdengine-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"vllm"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##vllm-pre|${{ needs.vllm-pre.outputs.test-result }}"
              fi
             
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"orioledb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##orioledb-pre|${{ needs.orioledb-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"vanilla-pg"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##vanilla-pg-pre|${{ needs.vanilla-pg-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"ggml"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##ggml-pre|${{ needs.ggml-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"zookeeper"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##zookeeper-pre|${{ needs.zookeeper-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mariadb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##mariadb-pre|${{ needs.mariadb-pre.outputs.test-result }}"
              fi
          fi
          
          if [[ "${{ inputs.release-version }}" != "v0.5."* && "${{ inputs.release-version }}" != "v0.6."* && "${{ inputs.release-version }}" != "v0.7."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"tidb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##tidb-pre|${{ needs.tidb-pre.outputs.test-result }}"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"xinference"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##xinference-pre|${{ needs.xinference-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"oracle|"* || "$TEST_TYPE" == *"oracle" ]]; then
                  TEST_RESULT="${TEST_RESULT}##oracle-pre|${{ needs.oracle-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"opengauss"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##opengauss-pre|${{ needs.opengauss-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"influxdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##influxdb-pre|${{ needs.influxdb-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"flink"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##flink-pre|${{ needs.flink-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mogdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##mogdb-pre|${{ needs.mogdb-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"redis-cluster"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##redis-cluster-pre|${{ needs.redis-cluster-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"dmdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##dmdb-pre|${{ needs.dmdb-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"minio"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##minio-pre|${{ needs.minio-pre.outputs.test-result }}"
              fi
          fi
          
          if [[ "${{ inputs.release-version }}" != "v0.5."* && "${{ inputs.release-version }}" != "v0.6."* && "${{ inputs.release-version }}" != "v0.7."* && "${{ inputs.release-version }}" != "v0.8."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"solr"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##solr-pre|${{ needs.solr-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"oceanbase-ent"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##oceanbase-ent-pre|${{ needs.oceanbase-ent-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"starrocks-ent"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##starrocks-ent-pre|${{ needs.starrocks-ent-pre.outputs.test-result }}"
              fi
          
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"yashandb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##yashandb-pre|${{ needs.yashandb-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"orchestrator"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##orchestrator-pre|${{ needs.orchestrator-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"rabbitmq"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##rabbitmq-pre|${{ needs.rabbitmq-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"loki"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##loki-pre|${{ needs.loki-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"victoria-metrics"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##victoria-metrics-pre|${{ needs.victoria-metrics-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"gaussdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##gaussdb-pre|${{ needs.gaussdb-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"damengdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##damengdb-pre|${{ needs.damengdb-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"kingbase"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##kingbase-pre|${{ needs.kingbase-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"vastbase"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##vastbase-pre|${{ needs.vastbase-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mssql"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##mssql-pre|${{ needs.mssql-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"rocketmq"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##rocketmq-pre|${{ needs.rocketmq-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"goldendb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##goldendb-pre|${{ needs.goldendb-pre.outputs.test-result }}"
              fi

              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"tdsql"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##tdsql-pre|${{ needs.tdsql-pre.outputs.test-result }}"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"greatsql"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##greatsql-pre|${{ needs.greatsql-pre.outputs.test-result }}"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"greatdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##greatdb-pre|${{ needs.greatdb-pre.outputs.test-result }}"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mongodb-shard"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##mongodb-shard-pre|${{ needs.mongodb-shard-pre.outputs.test-result }}"
              fi
          fi
          if [[ "${{ inputs.release-version }}" != "v0.5."* && "${{ inputs.release-version }}" != "v0.6."* && "${{ inputs.release-version }}" != "v0.7."* && "${{ inputs.release-version }}" != "v0.8."* && "${{ inputs.release-version }}" != "v0.9."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"postgresql-etcd|"* || "$TEST_TYPE" == *"postgresql-etcd" ]]; then
                  TEST_RESULT="${TEST_RESULT}##postgresql-etcd-pre|${{ needs.postgresql-etcd-pre.outputs.test-result }}"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"asmysql-proxy|"* || "$TEST_TYPE" == *"asmysql-proxy" ]]; then
                  TEST_RESULT="${TEST_RESULT}##asmysql-proxy-pre|${{ needs.asmysql-proxy-pre.outputs.test-result }}"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"asmysql-orc|"* || "$TEST_TYPE" == *"asmysql-orc" ]]; then
                  TEST_RESULT="${TEST_RESULT}##asmysql-orc-pre|${{ needs.asmysql-orc-pre.outputs.test-result }}"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"asmysql-orc-proxy|"* || "$TEST_TYPE" == *"asmysql-orc-proxy" ]]; then
                  TEST_RESULT="${TEST_RESULT}##asmysql-orc-proxy-pre|${{ needs.asmysql-orc-proxy-pre.outputs.test-result }}"
              fi
          fi
          
          TEST_RESULT=$( bash .github/utils/utils.sh --type 12 \
              --github-repo "${{ github.repository }}" \
              --github-token "${{ env.GITHUB_TOKEN }}" \
              --test-result "${TEST_RESULT}" \
              --run-id "$GITHUB_RUN_ID" )
          
          export TZ='Asia/Shanghai'
          date_ret=$(date +%Y-%m-%d-%T)
          test_title="[${{ inputs.release-version }}] Pre Test KBCLI on ${{ inputs.cloud-provider }}:${{ inputs.CLUSTER_VERSION }}:${{ inputs.INSTANCE_TYPE }} [${date_ret}]"
          if [[ -n "${{ inputs.previous-version }}" ]]; then
              test_title="[${{ inputs.previous-version }}] upgrade to "$test_title
          fi
          python3 .github/utils/send_mesage.py \
              --url "${{ vars.TEST_BOT_WEBHOOK }}" \
              --title "$test_title" \
              --result "$TEST_RESULT"

  install-kubeblocks:
    if: ${{ always() }}
    needs: [ install-kubeblocks-pre, send-message ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.cloud-provider }}
      region: ${{ inputs.region }}
      release-version: "${{ inputs.release-version }}"
      test-type: "0"
      test-type-name: "install-kubeblocks"
      test-args: "--config-s3 true --upgrade true ${{ inputs.test-args }}"
      k8s-cluster-name: ${{ inputs.k8s-cluster-name }}
      artifact-name: ${{ inputs.artifact-name }}
      branch-name: ${{ inputs.branch-name }}
      random-suffix: ${{ needs.install-kubeblocks-pre.outputs.random-suffix }}
    secrets: inherit

