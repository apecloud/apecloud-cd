name: Kbcli Test on K8S

on:
  workflow_dispatch:
    inputs:
      CLOUD_PROVIDER:
        description: 'cloud k8s cluster provider (e.g. vke/eks/gke/aks)'
        required: false
        default: 'aks'
      KB_VERSION:
        description: 'kubeblocks release version'
        required: false
        default: 'latest'
      KB_PRE_VERSION:
        description: 'kubeblocks previous version of upgrade'
        type: string
        required: false
        default: ''
      TEST_TYPE:
        description: 'test type (e.g. apecloud-mysql|postgresql|redis|mongodb|kafka|pulsar|weaviate|qdrant|
        greptimedb|nebula|risingwave|starrocks|etcd|oceanbase|orioledb|vanilla-pg|asmysql|openldap|
        polardbx|opensearch|elasticsearch|vllm|tdengine|milvus|clickhouse|pika|ggml|zookeeper|mariadb|tidb|xinference|
        oracle|opengauss|influxdb|flink|solr|mogdb|oceanbase-ent|starrocks-ent|yashandb|
        redis-cluster|dmdb|minio|orchestrator|rabbitmq|loki|victoria-metrics|gaussdb|damengdb|
        kingbase|vastbase|mssql|rocketmq|goldendb|tdsql|greatsql)'
        type: string
        required: false
        default: ''
      CLUSTER_VERSION:
        description: 'k8s cluster version (e.g. 1.32)'
        required: false
        default: '1.32'
      REGION:
        description: 'k8s region name'
        required: false
        default: 'eastus'
      INSTANCE_TYPE:
        description: 'node instance types (e.g. amd64/arm64)'
        required: false
        default: 'amd64'
      BRANCH_NAME:
        description: 'testinfra branch name'
        required: false
        default: 'main'
      APECD_REF:
        description: "The branch name of apecloud-cd"
        required: false
        default: 'main'
      ARGS:
        description: "Test args"
        required: false
        default: ''
  workflow_call:
    inputs:
      CLOUD_PROVIDER:
        description: 'cloud k8s cluster provider'
        type: string
        required: false
        default: 'eks'
      KB_VERSION:
        description: 'kubeblocks release version'
        type: string
        required: false
        default: 'latest'
      KB_PRE_VERSION:
        description: 'kubeblocks previous version of upgrade'
        type: string
        required: false
        default: ''
      TEST_TYPE:
        description: 'test type'
        type: string
        required: false
        default: ''
      CLUSTER_VERSION:
        description: 'k8s cluster version'
        type: string
        required: false
        default: '1.32'
      REGION:
        description: 'k8s region name'
        type: string
        required: false
        default: 'eastus'
      INSTANCE_TYPE:
        description: 'node instance types'
        type: string
        required: false
        default: 'amd64'
      BRANCH_NAME:
        description: 'testinfra branch name'
        type: string
        required: false
        default: 'main'
      APECD_REF:
        description: "The branch name of apecloud-cd"
        type: string
        required: false
        default: 'main'
      ARGS:
        description: "Test args"
        type: string
        required: false
        default: ''

run-name: kbcli:${{ inputs.KB_PRE_VERSION }} to ${{ inputs.KB_VERSION }} ${{ inputs.CLOUD_PROVIDER }}:${{ inputs.CLUSTER_VERSION }}:${{ inputs.INSTANCE_TYPE }} ${{ inputs.TEST_TYPE }}

env:
  GITHUB_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
  PYTHON_VERSION: "3.11"
  OSS_KEY_ID: ${{ secrets.OSS_KEY_ID }}
  OSS_KEY_SECRET: ${{ secrets.OSS_KEY_SECRET }}
  OSS_ENDPOINT: "oss-cn-zhangjiakou.aliyuncs.com"
  OSS_BUCKET: "kubeblocks-oss"

permissions:
  id-token: write
  contents: read

jobs:
  test-playground:
    if: ${{ inputs.TEST_TYPE == '' && inputs.KB_PRE_VERSION == '' && inputs.CLOUD_PROVIDER != 'vke' && inputs.CLOUD_PROVIDER != 'aks' }}
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      test-type: "4"
      test-type-name: "playground"
      test-args: "${{ inputs.ARGS }}"
      branch-name: ${{ inputs.BRANCH_NAME }}
    secrets: inherit

  terraform-init-k8s:
    uses: ./.github/workflows/terraform-init.yml
    with:
      test-type: ${{ inputs.TEST_TYPE }}
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      cluster-version: ${{ inputs.CLUSTER_VERSION }}
      instance-type: ${{ inputs.INSTANCE_TYPE }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      region: ${{ inputs.REGION }}
      kb-version: "${{ inputs.KB_VERSION }}"
    secrets: inherit

  test-kubeblocks:
    if: ${{ needs.terraform-init-k8s.result == 'success' }}
    needs: terraform-init-k8s
    uses: ./.github/workflows/kbcli-pre-test-k8s.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "${{ inputs.TEST_TYPE }}"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
    secrets: inherit

  test-apecloud-mysql:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'apecloud-mysql')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "1"
      test-type-name: "apecloud-mysql"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-postgresql:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'postgresql|') || endsWith(inputs.TEST_TYPE, 'postgresql')) && ! contains(inputs.TEST_TYPE, '-postgresql') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "2"
      test-type-name: "postgresql"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-redis:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'redis|') || endsWith(inputs.TEST_TYPE, 'redis')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "5"
      test-type-name: "redis"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-mongodb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'mongodb')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "6"
      test-type-name: "mongodb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-kafka:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'kafka')) && ! contains(inputs.KB_VERSION, 'v0.5.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "7"
      test-type-name: "kafka"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-pulsar:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'pulsar|') || endsWith(inputs.TEST_TYPE, 'pulsar')) && (contains(inputs.KB_VERSION, 'v0.6.') || contains(inputs.KB_VERSION, 'v0.7.') || contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "8"
      test-type-name: "pulsar"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-weaviate:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'weaviate')) && ! contains(inputs.KB_VERSION, 'v0.5.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "9"
      test-type-name: "weaviate"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-qdrant:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'qdrant')) && ! contains(inputs.KB_VERSION, 'v0.5.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "10"
      test-type-name: "qdrant"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-greptimedb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'greptimedb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "11"
      test-type-name: "greptimedb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-nebula:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'nebula')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "12"
      test-type-name: "nebula"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-risingwave:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'risingwave')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "13"
      test-type-name: "risingwave"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-starrocks:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'starrocks|') || endsWith(inputs.TEST_TYPE, 'starrocks')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "14"
      test-type-name: "starrocks"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-etcd:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'etcd')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "15"
      test-type-name: "etcd"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-oceanbase:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'oceanbase|') || endsWith(inputs.TEST_TYPE, 'oceanbase')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "16"
      test-type-name: "oceanbase"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-orioledb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'orioledb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "18"
      test-type-name: "orioledb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-vanilla-pg:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'vanilla-pg')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "20"
      test-type-name: "vanilla-pg"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-asmysql:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'asmysql|') || endsWith(inputs.TEST_TYPE, 'asmysql')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "21"
      test-type-name: "asmysql"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-asmysql-proxy:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'asmysql-proxy|') || endsWith(inputs.TEST_TYPE, 'asmysql-proxy')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.9.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "21"
      test-type-name: "asmysql-proxy"
      test-args: "--enable-proxy true ${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-asmysql-orc:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'asmysql-orc|') || endsWith(inputs.TEST_TYPE, 'asmysql-orc')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.9.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "21"
      test-type-name: "asmysql-orc"
      test-args: "--enable-orchestrator true ${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-asmysql-orc-proxy:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'asmysql-orc-proxy|') || endsWith(inputs.TEST_TYPE, 'asmysql-orc-proxy')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.9.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "21"
      test-type-name: "asmysql-orc-proxy"
      test-args: "--enable-proxy true --enable-orchestrator true ${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-openldap:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'openldap')) && (contains(inputs.KB_VERSION, 'v0.7.') || contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "22"
      test-type-name: "openldap"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-polardbx:
    if: ${{ ! (contains(inputs.KB_VERSION, 'v1.0.') && inputs.CLOUD_PROVIDER == 'aks') && needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'polardbx')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "23"
      test-type-name: "polardbx"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-opensearch:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'opensearch')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "24"
      test-type-name: "opensearch"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-elasticsearch:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'elasticsearch')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "25"
      test-type-name: "elasticsearch"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-vllm:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'vllm')) && (contains(inputs.KB_VERSION, 'v0.7.') || contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "26"
      test-type-name: "vllm"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-tdengine:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'tdengine')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "27"
      test-type-name: "tdengine"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-milvus:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'milvus')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "28"
      test-type-name: "milvus"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-clickhouse:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'clickhouse')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "29"
      test-type-name: "clickhouse"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-pika:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'pika')) && (contains(inputs.KB_VERSION, 'v0.7.') || contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "30"
      test-type-name: "pika"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-ggml:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'ggml')) && (contains(inputs.KB_VERSION, 'v0.7.') || contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "31"
      test-type-name: "ggml"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-zookeeper:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'zookeeper')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "32"
      test-type-name: "zookeeper"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-mariadb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'mariadb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "33"
      test-type-name: "mariadb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-tidb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'tidb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "34"
      test-type-name: "tidb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-xinference:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'xinference')) && (contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "35"
      test-type-name: "xinference"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-oracle:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'oracle|') || endsWith(inputs.TEST_TYPE, 'oracle')) && (contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "36"
      test-type-name: "oracle"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-opengauss:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'opengauss')) && (contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "37"
      test-type-name: "opengauss"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-influxdb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'influxdb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "38"
      test-type-name: "influxdb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-flink:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'flink')) && (contains(inputs.KB_VERSION, 'v0.8.') || contains(inputs.KB_VERSION, 'v0.9.')) }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "39"
      test-type-name: "flink"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-solr:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'solr')) && contains(inputs.KB_VERSION, 'v0.9.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "40"
      test-type-name: "solr"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-mogdb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'mogdb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "43"
      test-type-name: "mogdb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-oceanbase-ent:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'oceanbase-ent')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "44"
      test-type-name: "oceanbase-ent"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-starrocks-ent:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'starrocks-ent')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "45"
      test-type-name: "starrocks-ent"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-yashandb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'yashandb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "47"
      test-type-name: "yashandb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-redis-cluster:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'redis-cluster')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "48"
      test-type-name: "redis-cluster"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-dmdb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'dmdb')) && contains(inputs.KB_VERSION, 'v0.9.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "50"
      test-type-name: "dmdb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-minio:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'minio')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "51"
      test-type-name: "minio"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-orchestrator:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'orchestrator')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "52"
      test-type-name: "orchestrator"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-rabbitmq:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'rabbitmq')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "53"
      test-type-name: "rabbitmq"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-loki:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'loki')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "54"
      test-type-name: "loki"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-victoria-metrics:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'victoria-metrics')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "55"
      test-type-name: "victoria-metrics"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-gaussdb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'gaussdb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "56"
      test-type-name: "gaussdb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-damengdb:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'damengdb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "57"
      test-type-name: "damengdb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-kingbase:
    if: ${{ inputs.CLOUD_PROVIDER != 'aks' && needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'kingbase')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "58"
      test-type-name: "kingbase"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-vastbase:
    if: ${{ inputs.CLOUD_PROVIDER != 'eks' && needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'vastbase')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "59"
      test-type-name: "vastbase"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-mssql:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'mssql')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "60"
      test-type-name: "mssql"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-rocketmq:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'rocketmq')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "61"
      test-type-name: "rocketmq"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-goldendb:
    if: ${{ ! (contains(inputs.KB_VERSION, 'v1.0.') && inputs.CLOUD_PROVIDER == 'aks') && needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'goldendb')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "63"
      test-type-name: "goldendb"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-tdsql:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'tdsql')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "64"
      test-type-name: "tdsql"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  test-greatsql:
    if: ${{ needs.terraform-init-k8s.result == 'success' && always() && (inputs.TEST_TYPE == '' || contains(inputs.TEST_TYPE, 'greatsql')) && ! contains(inputs.KB_VERSION, 'v0.5.') && ! contains(inputs.KB_VERSION, 'v0.6.') && ! contains(inputs.KB_VERSION, 'v0.7.') && ! contains(inputs.KB_VERSION, 'v0.8.') && ! contains(inputs.KB_VERSION, 'v0.1.') }}
    needs: [ terraform-init-k8s, test-kubeblocks ]
    uses: ./.github/workflows/test-kbcli.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      region: ${{ inputs.REGION }}
      release-version: "${{ inputs.KB_VERSION }}"
      previous-version: "${{ inputs.KB_PRE_VERSION }}"
      test-type: "65"
      test-type-name: "greatsql"
      test-args: "${{ inputs.ARGS }}"
      k8s-cluster-name: ${{ needs.terraform-init-k8s.outputs.k8s-cluster-name }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      branch-name: ${{ inputs.BRANCH_NAME }}
      random-suffix: ${{ needs.test-kubeblocks.outputs.random-suffix }}
    secrets: inherit

  send-message:
    if: ${{ always() }}
    runs-on: ubuntu-latest
    outputs:
      test-date: ${{ steps.upload_test_result.outputs.test-date }}
    needs: [ test-playground, test-kubeblocks, test-apecloud-mysql, test-postgresql, test-redis,
             test-mongodb, test-kafka, test-pulsar, test-weaviate, test-qdrant,
             test-greptimedb, test-nebula, test-risingwave, test-starrocks,
             test-etcd, test-oceanbase, test-asmysql, test-asmysql-proxy,
             test-asmysql-orc, test-asmysql-orc-proxy,
             test-openldap, test-polardbx, test-tdengine, test-milvus, test-clickhouse,
             test-pika, test-opensearch, test-elasticsearch, test-vllm, test-orioledb,
             test-vanilla-pg, test-ggml, test-zookeeper, test-mariadb , test-tidb,
             test-xinference, test-oracle , test-opengauss, test-influxdb, test-flink,
             test-solr, test-mogdb, test-oceanbase-ent, test-starrocks-ent,
             test-yashandb, test-redis-cluster, test-dmdb, test-minio, test-orchestrator,
             test-rabbitmq, test-loki, test-victoria-metrics, test-gaussdb, test-damengdb,
             test-kingbase, test-vastbase, test-mssql, test-rocketmq, test-goldendb,
             test-tdsql, test-greatsql ]
    steps:
      - uses: actions/checkout@v4
        with:
          repository: apecloud/apecloud-cd
          path: ./
          ref: ${{ inputs.APECD_REF }}

      - name: send message
        run: |
          TEST_TYPE="${{ inputs.TEST_TYPE }}"
          cmd_head="bash .github/utils/utils.sh --type 36 --test-result "
          TEST_RESULT="playground|${{ needs.test-playground.outputs.test-result }}##install-kubeblocks|${{ needs.test-kubeblocks.outputs.test-result }}"
          if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"apecloud-mysql"* ]]; then
              TEST_RESULT="${TEST_RESULT}##apecloud-mysql|${{ needs.test-apecloud-mysql.outputs.test-result }}"
              cmd="${cmd_head} \"${{ needs.test-apecloud-mysql.outputs.test-result-report }}\" "
              eval "$cmd"
          fi
          if [[ "$TEST_TYPE" == '' || (("$TEST_TYPE" == *"postgresql|"* || "$TEST_TYPE" == *"postgresql") && "$TEST_TYPE" != *"-postgresql"* ) ]]; then
              TEST_RESULT="${TEST_RESULT}##postgresql|${{ needs.test-postgresql.outputs.test-result }}"
              cmd="${cmd_head} \"${{ needs.test-postgresql.outputs.test-result-report }}\" "
              eval "$cmd"
          fi
          if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"redis|"* || "$TEST_TYPE" == *"redis" ]]; then
              TEST_RESULT="${TEST_RESULT}##redis|${{ needs.test-redis.outputs.test-result }}"
              cmd="${cmd_head} \"${{ needs.test-redis.outputs.test-result-report }}\" "
              eval "$cmd"
          fi
          if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mongodb"* ]]; then
              TEST_RESULT="${TEST_RESULT}##mongodb|${{ needs.test-mongodb.outputs.test-result }}"
              cmd="${cmd_head} \"${{ needs.test-mongodb.outputs.test-result-report }}\" "
              eval "$cmd"
          fi
          if [[ "${{ inputs.KB_VERSION }}" != "v0.5."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"kafka"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##kafka|${{ needs.test-kafka.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-kafka.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"pulsar|"* || "$TEST_TYPE" == *"pulsar" ]]; then
                  TEST_RESULT="${TEST_RESULT}##pulsar|${{ needs.test-pulsar.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-pulsar.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"weaviate"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##weaviate|${{ needs.test-weaviate.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-weaviate.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"qdrant"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##qdrant|${{ needs.test-qdrant.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-qdrant.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
          fi
          if [[ "${{ inputs.KB_VERSION }}" != "v0.5."* && "${{ inputs.KB_VERSION }}" != "v0.6."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"greptimedb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##greptimedb|${{ needs.test-greptimedb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-greptimedb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"nebula"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##nebula|${{ needs.test-nebula.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-nebula.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"risingwave"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##risingwave|${{ needs.test-risingwave.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-risingwave.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"starrocks|"* || "$TEST_TYPE" == *"starrocks" ]]; then
                  TEST_RESULT="${TEST_RESULT}##starrocks|${{ needs.test-starrocks.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-starrocks.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"etcd"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##etcd|${{ needs.test-etcd.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-outputs.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"oceanbase|"* || "$TEST_TYPE" == *"oceanbase" ]]; then
                  TEST_RESULT="${TEST_RESULT}##oceanbase|${{ needs.test-oceanbase.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-oceanbase.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"asmysql|"* || "$TEST_TYPE" == *"asmysql" ]]; then
                  TEST_RESULT="${TEST_RESULT}##asmysql|${{ needs.test-asmysql.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-asmysql.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"openldap"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##openldap|${{ needs.test-openldap.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-openldap.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"polardbx"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##polardbx|${{ needs.test-polardbx.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-polardbx.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"milvus"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##milvus|${{ needs.test-milvus.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-milvus.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"clickhouse"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##clickhouse|${{ needs.test-clickhouse.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-clickhouse.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"pika"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##pika|${{ needs.test-pika.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-pika.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"opensearch"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##opensearch|${{ needs.test-opensearch.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-opensearch.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"elasticsearch"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##elasticsearch|${{ needs.test-elasticsearch.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-elasticsearch.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"tdengine"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##tdengine|${{ needs.test-tdengine.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-tdengine.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"vllm"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##vllm|${{ needs.test-vllm.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-vllm.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"orioledb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##orioledb|${{ needs.test-orioledb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-orioledb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"vanilla-pg"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##vanilla-pg|${{ needs.test-vanilla-pg.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-vanilla-pg.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"ggml"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##ggml|${{ needs.test-ggml.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-ggml.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"zookeeper"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##zookeeper|${{ needs.test-zookeeper.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-zookeeper.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mariadb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##mariadb|${{ needs.test-mariadb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-mariadb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
          fi
          if [[ "${{ inputs.KB_VERSION }}" != "v0.5."* && "${{ inputs.KB_VERSION }}" != "v0.6."* && "${{ inputs.KB_VERSION }}" != "v0.7."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"tidb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##tidb|${{ needs.test-tidb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-tidb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"xinference"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##xinference|${{ needs.test-xinference.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-xinference.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"oracle|"* || "$TEST_TYPE" == *"oracle" ]]; then
                  TEST_RESULT="${TEST_RESULT}##oracle|${{ needs.test-oracle.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-oracle.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"opengauss"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##opengauss|${{ needs.test-opengauss.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-opengauss.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"influxdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##influxdb|${{ needs.test-influxdb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-influxdb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"flink"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##flink|${{ needs.test-flink.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-flink.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mogdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##mogdb|${{ needs.test-mogdb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-mogdb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"redis-cluster"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##redis-cluster|${{ needs.test-redis-cluster.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-redis-cluster.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
          fi
          
          if [[ "${{ inputs.KB_VERSION }}" != "v0.5."* && "${{ inputs.KB_VERSION }}" != "v0.6."* && "${{ inputs.KB_VERSION }}" != "v0.7."* && "${{ inputs.KB_VERSION }}" != "v0.8."* ]]; then
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"solr"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##solr|${{ needs.test-solr.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-solr.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"oceanbase-ent"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##oceanbase-ent|${{ needs.test-oceanbase-ent.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-oceanbase-ent.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"starrocks-ent"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##starrocks-ent|${{ needs.test-starrocks-ent.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-starrocks-ent.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"yashandb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##yashandb|${{ needs.test-yashandb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-yashandb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"dmdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##dmdb|${{ needs.test-dmdb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-dmdb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"minio"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##minio|${{ needs.test-minio.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-minio.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"orchestrator"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##orchestrator|${{ needs.test-orchestrator.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-orchestrator.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"rabbitmq"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##rabbitmq|${{ needs.test-rabbitmq.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-rabbitmq.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"loki"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##loki|${{ needs.test-loki.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-loki.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"victoria-metrics"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##victoria-metrics|${{ needs.test-victoria-metrics.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-victoria-metrics.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"gaussdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##gaussdb|${{ needs.test-gaussdb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-gaussdb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"damengdb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##damengdb|${{ needs.test-damengdb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-damengdb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"kingbase"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##kingbase|${{ needs.test-kingbase.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-kingbase.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"vastbase"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##vastbase|${{ needs.test-vastbase.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-vastbase.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"mssql"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##mssql|${{ needs.test-mssql.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-mssql.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"rocketmq"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##rocketmq|${{ needs.test-rocketmq.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-rocketmq.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"goldendb"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##goldendb|${{ needs.test-goldendb.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-goldendb.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"tdsql"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##tdsql|${{ needs.test-tdsql.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-tdsql.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || "$TEST_TYPE" == *"greatsql"* ]]; then
                  TEST_RESULT="${TEST_RESULT}##greatsql|${{ needs.test-greatsql.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-greatsql.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
          fi
          if [[ "${{ inputs.KB_VERSION }}" != "v0.5."* && "${{ inputs.KB_VERSION }}" != "v0.6."* && "${{ inputs.KB_VERSION }}" != "v0.7."* && "${{ inputs.KB_VERSION }}" != "v0.8."* && "${{ inputs.KB_VERSION }}" != "v0.9."* ]]; then
              if [[ "$TEST_TYPE" == '' || (("$TEST_TYPE" == *"asmysql-proxy|"* || "$TEST_TYPE" == *"asmysql-proxy") && "$TEST_TYPE" != *"-postgresql"* ) ]]; then
                  TEST_RESULT="${TEST_RESULT}##asmysql-proxy|${{ needs.test-asmysql-proxy.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-asmysql-proxy.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || (("$TEST_TYPE" == *"asmysql-orc|"* || "$TEST_TYPE" == *"asmysql-orc") && "$TEST_TYPE" != *"-postgresql"* ) ]]; then
                  TEST_RESULT="${TEST_RESULT}##asmysql-orc|${{ needs.test-asmysql-orc.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-asmysql-orc.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
              if [[ "$TEST_TYPE" == '' || (("$TEST_TYPE" == *"asmysql-orc-proxy|"* || "$TEST_TYPE" == *"asmysql-orc-proxy") && "$TEST_TYPE" != *"-postgresql"* ) ]]; then
                  TEST_RESULT="${TEST_RESULT}##asmysql-orc-proxy|${{ needs.test-asmysql-orc-proxy.outputs.test-result }}"
                  cmd="${cmd_head} \"${{ needs.test-asmysql-orc-proxy.outputs.test-result-report }}\" "
                  eval "$cmd"
              fi
          fi
          
          TEST_RESULT=$( bash .github/utils/utils.sh --type 12 \
              --github-repo "${{ github.repository }}" \
              --github-token "${{ env.GITHUB_TOKEN }}" \
              --test-result "${TEST_RESULT}" \
              --run-id "$GITHUB_RUN_ID" )
          
          export TZ='Asia/Shanghai'
          date_ret=$(date +%Y-%m-%d-%T)
          test_title="[${{ inputs.KB_VERSION }}] Test KBCLI on ${{ inputs.CLOUD_PROVIDER }}:${{ inputs.CLUSTER_VERSION }}:${{ inputs.INSTANCE_TYPE }} [${date_ret}]"
          
          if [[ -n "${{ inputs.ARGS }}" && "${{ inputs.ARGS }}" == *"--only-kubectl true"* ]]; then
              test_title="[${{ inputs.KB_VERSION }}] Test KB-Addons Examples on ${{ inputs.CLOUD_PROVIDER }}:${{ inputs.CLUSTER_VERSION }}:${{ inputs.INSTANCE_TYPE }} [${date_ret}]"
          fi
          
          if [[ -n "${{ inputs.KB_PRE_VERSION }}" ]]; then
              test_title="[${{ inputs.KB_PRE_VERSION }}] upgrade to "$test_title
          fi
          echo $TEST_RESULT
          python3 .github/utils/send_mesage.py \
              --url "${{ vars.TEST_BOT_WEBHOOK }}" \
              --title "$test_title" \
              --result "$TEST_RESULT"

      - name: Setup ossutil
        if: ${{ ! (contains(inputs.ARGS, 'only-kubectl') && contains(inputs.ARGS, 'true')) && contains(inputs.ARGS, 'generate-outputl') && contains(inputs.ARGS, 'true') }}
        uses: manyuanrong/setup-ossutil@v2.0
        with:
          access-key-id: "${{ env.OSS_KEY_ID }}"
          access-key-secret: "${{ env.OSS_KEY_SECRET }}"
          endpoint: "${{ env.OSS_ENDPOINT }}"

      - name: Upload test result log to oss
        if: ${{ ! (contains(inputs.ARGS, 'only-kubectl') && contains(inputs.ARGS, 'true')) && contains(inputs.ARGS, 'generate-outputl') && contains(inputs.ARGS, 'true') }}
        id: upload_test_result
        run: |
          export TZ='Asia/Shanghai'
          TEST_DATE="$(date +%Y%m%d)"
          echo test-date=${TEST_DATE} >> $GITHUB_OUTPUT
          
          KUBEBLOCKS_VERSION="${{ inputs.KB_VERSION }}"
          OSS_DIR="oss://${{ env.OSS_BUCKET }}/reports/kubeblocks/${KUBEBLOCKS_VERSION}/${TEST_DATE}"
          upload_file_name="TEST_RESULT_LOGS.txt"
          
          for i in $(seq 1 3); do
              ossutil cp -rf "${OSS_DIR}/${upload_file_name}" ./
              download_ret=$?
              if [[ $download_ret -eq 0 ]]; then
                  break
              fi
              sleep 1
          done
          
          test_result_report_output_file_log="test-result-report-output.log"
          if [[ -f ${test_result_report_output_file_log} ]]; then
              cat ${test_result_report_output_file_log}
              if [[ ! -f ${upload_file_name} ]]; then
                  touch ${upload_file_name}
              else
                  echo "" >> ${upload_file_name}
              fi
              cat ${test_result_report_output_file_log} >> ${upload_file_name}
          
              for i in $(seq 1 3); do
                  ossutil cp -rf "${upload_file_name}" "${OSS_DIR}/${upload_file_name}"
                  upload_ret=$?
                  if [[ $upload_ret -eq 0 ]]; then
                      echo "$(tput -T xterm setaf 2)upload ${upload_file_name} to oss successfully$(tput -T xterm sgr0)"
                      break
                  else
                      echo "$(tput -T xterm setaf 3)::warning title=upload ${upload_file_name} to oss failure$(tput -T xterm sgr0)"
                  fi
                  sleep 1
              done
          fi

  terraform-destroy-k8s:
    if: ${{ always() }}
    needs: [ terraform-init-k8s, send-message ]
    uses: ./.github/workflows/terraform-destroy.yml
    with:
      cloud-provider: ${{ inputs.CLOUD_PROVIDER }}
      artifact-name: cicd-${{ inputs.CLOUD_PROVIDER }}-${{ github.sha }}
      region: ${{ inputs.REGION }}
    secrets: inherit
    
  upload-test-report:
    if: ${{ always() && ! (contains(inputs.ARGS, 'only-kubectl') && contains(inputs.ARGS, 'true')) && contains(inputs.ARGS, 'generate-outputl') && contains(inputs.ARGS, 'true') }}
    runs-on: ubuntu-latest
    needs: [ send-message ]
    steps:
      - name: checkout testinfra
        uses: actions/checkout@v4
        with:
          repository: apecloud/testinfra
          ref: "${{ inputs.BRANCH_NAME }}"
          path: ./
          token: ${{ env.GITHUB_TOKEN }}

      - uses: manyuanrong/setup-ossutil@v2.0
        with:
          access-key-id: "${{ env.OSS_KEY_ID }}"
          access-key-secret: "${{ env.OSS_KEY_SECRET }}"
          endpoint: "${{ env.OSS_ENDPOINT }}"

      - name: download test result log
        run: |
          TEST_DATE=${{ needs.send-message.outputs.test-date }}
          KUBEBLOCKS_VERSION="${{ inputs.KB_VERSION }}"
          OSS_DIR="oss://${{ env.OSS_BUCKET }}/reports/kubeblocks/${KUBEBLOCKS_VERSION}/${TEST_DATE}"
          upload_file_name="TEST_RESULT_LOGS.txt"
          
          for i in $(seq 1 3); do
              ossutil cp -rf "${OSS_DIR}/${upload_file_name}" ./test/report/
              download_ret=$?
              if [[ $download_ret -eq 0 ]]; then
                  echo "$(tput -T xterm setaf 2)download ${upload_file_name} from oss successfully$(tput -T xterm sgr0)"
                  break
              fi
              sleep 1
          done
          
          if [[ ! -f "./test/report/${upload_file_name}" ]]; then
              echo "$(tput -T xterm setaf 1)::error title=download ${upload_file_name} from oss failure$(tput -T xterm sgr0)"
              exit 1
          fi

      - name: install wkhtmltopdf
        run: |
          sudo rm /etc/apt/sources.list.d/microsoft-prod.list
          sudo apt-get update
          sudo apt-get install -y --no-install-recommends wkhtmltopdf fonts-wqy-zenhei fonts-wqy-microhei

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "${{ env.PYTHON_VERSION }}"

      - name: checkout pystan2
        uses: actions/checkout@v4
        with:
          submodules: 'recursive'
          repository: stan-dev/pystan2
          ref: "v2.19.1.1"
          path: pystan2

      - name: install Cython and NumPy
        run: |
          pip3 install Cython==3.0.9 NumPy==1.24.3

      - name: install pystan 2.19.1.1
        run: |
          cd pystan2
          python3 setup.py install

      - name: install python requirements
        run: |
          cd test/report
          sed -i 's/^appscript==.*/#appscript==/' requirements.txt
          pip3 install -r requirements.txt

      - name: checkout apecloud-cd
        uses: actions/checkout@v4
        with:
          repository: apecloud/apecloud-cd
          path: ./apecloud-cd
          ref: ${{ inputs.APECD_REF }}

      - name: generate report
        run: |
          sudo locale-gen zh_CN.UTF-8
          sudo update-locale
          locale -a
          cd test/report
          bash update_test_period.sh ./md
          
          mkdir -p reports/cn
          for i in $(seq 1 3); do
              python3 ./report.py \
                  --raw=TEST_RESULT_LOGS.txt \
                  --main_report=TEST_REPORT_ALL.pdf \
                  --smoke_report=TEST_REPORT_SMOKE.pdf \
                  --ha_report=TEST_REPORT_CHAOS.pdf \
                  --upgrade_report=TEST_REPORT_UPGRADE.pdf 
              gen_ret=$?
              if [[ $gen_ret -eq 0 ]]; then
                  break
              fi
              sleep 1
          done

      - name: Upload test reports to oss
        run: |
          TEST_DATE=${{ needs.send-message.outputs.test-date }}
          KUBEBLOCKS_VERSION="${{ inputs.KB_VERSION }}"
          OSS_DIR="oss://${{ env.OSS_BUCKET }}/reports/kubeblocks/${KUBEBLOCKS_VERSION}/${TEST_DATE}"
          
          report_file_path="./test/report/reports/cn/"
          for report_file in $(ls ${report_file_path}); do
              if [[ ! -f "${report_file_path}/${report_file}" || "${report_file}" != *".pdf" ]]; then
                  continue
              fi
          
              for i in $(seq 1 3); do
                  ossutil cp -rf "${report_file_path}/${report_file}" "${OSS_DIR}/${report_file}"
                  upload_ret=$?
                  if [[ $upload_ret -eq 0 ]]; then
                      echo "$(tput -T xterm setaf 2)upload ${report_file} to oss successfully$(tput -T xterm sgr0)"
                      break
                  else
                      echo "$(tput -T xterm setaf 3)::warning title=upload ${report_file} to oss failure$(tput -T xterm sgr0)"
                  fi
                  sleep 1
              done
          done

      - name: send message
        run: |
          TEST_DATE=${{ needs.send-message.outputs.test-date }}
          KUBEBLOCKS_VERSION="${{ inputs.KB_VERSION }}"
          OSS_URL="https://${{ env.OSS_BUCKET }}.${{ env.OSS_ENDPOINT }}/reports/kubeblocks/${KUBEBLOCKS_VERSION}/${TEST_DATE}"
          test_result_file_name="TEST_RESULT_LOGS.txt"
          TEST_RESULT="${test_result_file_name}|${OSS_URL}/${test_result_file_name}"
          
          report_file_path="./test/report/reports/cn/"
          for report_file in $(ls ${report_file_path}); do
              if [[ ! -f "${report_file_path}/${report_file}" || "${report_file}" != *".pdf" ]]; then
                  continue
              fi
              TEST_RESULT="${TEST_RESULT}##${report_file}|${OSS_URL}/${report_file}"
          done
          
          REPORT_BOT_WEBHOOK="${{ vars.REPORT_BOT_WEBHOOK }}"
          if [[ -z "${REPORT_BOT_WEBHOOK}" ]]; then
              REPORT_BOT_WEBHOOK="${{ vars.TEST_BOT_WEBHOOK }}"
          fi
          
          test_title="[${KUBEBLOCKS_VERSION}] Test Report on ${{ inputs.CLOUD_PROVIDER }}:${{ inputs.CLUSTER_VERSION }}:${{ inputs.INSTANCE_TYPE }} [${TEST_DATE}]"
          python3 ./apecloud-cd/.github/utils/send_mesage.py \
              --url "${REPORT_BOT_WEBHOOK}" \
              --title "$test_title" \
              --result "$TEST_RESULT" \
              --send-type "report"

      - name: Checkout kubeblocks.io Code
        if: ${{ inputs.KB_PRE_VERSION == '' && ! contains(inputs.KB_VERSION, '-') && ! contains(inputs.KB_VERSION, 'a') && contains(inputs.ARGS, 'kubeblocks-io') && contains(inputs.ARGS, 'true') }}
        uses: actions/checkout@v4
        with:
          repository: "apecloud/kubeblocks.io"
          path: ./kubeblocks.io
          token: ${{ env.GITHUB_TOKEN }}
          ref: "master"

      - name: Add test report to kubeblocks.io
        id: add_test_report
        if: ${{ inputs.KB_PRE_VERSION == '' && ! contains(inputs.KB_VERSION, '-') && ! contains(inputs.KB_VERSION, 'a') && contains(inputs.ARGS, 'kubeblocks-io') && contains(inputs.ARGS, 'true') }}
        run: |
          KUBEBLOCKS_VERSION="${{ inputs.KB_VERSION }}"
          if [[ "${KUBEBLOCKS_VERSION}" == "v"*"."*"."* && "${KUBEBLOCKS_VERSION}" != "v"*"."*"."*"-"* ]]; then
              report_file_paths="./test/report/reports/|./test/report/reports/cn/"
              KUBEBLOCKS_REPORT_DIR="kubeblocks.io/static/report/kubeblocks/${KUBEBLOCKS_VERSION}"
              for report_file_path in $(echo "${report_file_paths}" | sed 's/|/ /g'); do
                    if [[ ! -d "${report_file_path}" ]]; then
                        continue
                    fi
                    kubeblocks_report_dir_tmp="${KUBEBLOCKS_REPORT_DIR}"
                    if [[ "${report_file_path}" == *"/cn/"*  ]]; then
                        kubeblocks_report_dir_tmp="${kubeblocks_report_dir_tmp}/cn"
                    fi
                    mkdir -p ${kubeblocks_report_dir_tmp}
          
                    for report_file in $(ls ${report_file_path}); do
                        if [[ ! -f "${report_file_path}/${report_file}" || "${report_file}" != *".html" ]]; then
                            continue
                        fi
                    
                        for i in $(seq 1 3); do
                            cp -r "${report_file_path}/${report_file}" "${kubeblocks_report_dir_tmp}/${report_file}"
                            copy_ret=$?
                            if [[ $copy_ret -eq 0 ]]; then
                                echo "$(tput -T xterm setaf 2)copy ${report_file} to ${kubeblocks_report_dir_tmp} successfully$(tput -T xterm sgr0)"
                                break
                            else
                                echo "$(tput -T xterm setaf 3)::warning title=copy ${report_file} to ${kubeblocks_report_dir_tmp} failure$(tput -T xterm sgr0)"
                            fi
                            sleep 1
                        done
                    done
              done
          
              cd ./kubeblocks.io
              git fetch --prune --unshallow
              git config user.name "$GITHUB_ACTOR"
              git config user.email "$GITHUB_ACTOR@users.noreply.github.com"
              kubeblocks_io_sha=$(git rev-parse HEAD)
              git add ${{ github.workspace }}/${KUBEBLOCKS_REPORT_DIR}
              FILE_CHANGES=$(git diff --name-only ${kubeblocks_io_sha})
              if [[ -n "$FILE_CHANGES" ]]; then
                  echo "FILE_CHANGES:"$FILE_CHANGES
                  git config --local user.name "$GITHUB_ACTOR"
                  git config --local user.email "$GITHUB_ACTOR@users.noreply.github.com"
                  git commit -a -m "chore: upload KubeBlocks ${KUBEBLOCKS_VERSION} test report"
              fi
              echo file_changes=$FILE_CHANGES >> $GITHUB_OUTPUT
          fi

      - name: Push test report to kubeblocks.io
        if: ${{ steps.add_test_report.outputs.file_changes != '' && inputs.KB_PRE_VERSION == '' && ! contains(inputs.KB_VERSION, '-') && ! contains(inputs.KB_VERSION, 'a') && contains(inputs.ARGS, 'kubeblocks-io') && contains(inputs.ARGS, 'true') }}
        uses: ad-m/github-push-action@master
        with:
          repository: "apecloud/kubeblocks.io"
          directory: ./kubeblocks.io
          github_token: ${{ env.GITHUB_TOKEN }}
          branch: "master"
